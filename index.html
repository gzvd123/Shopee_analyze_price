<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Pricing Analysis Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="utility-bar">
            <div class="branding">
                <span>Pro</span>
                <div>
                    <div>Pricing Intelligence Studio</div>
                    <small>Light &amp; Dark mode ‚Ä¢ Glassmorphism ‚Ä¢ Ready for scale</small>
                </div>
            </div>
            <div class="action-group">
                <button class="button-ghost" id="themeToggle">üåû Giao di·ªán s√°ng</button>
                <button class="button-ghost" id="resetApp">üßπ L√†m m·ªõi d·ªØ li·ªáu</button>
            </div>
        </div>
        <div class="header">
            <h1>üõçÔ∏è Product Pricing Analysis Tool</h1>
            <p>C√¥ng c·ª• ph√¢n t√≠ch gi√° b√°n s·∫£n ph·∫©m chuy√™n nghi·ªáp</p>
        </div>

        <div class="config-panel" id="config">
            <h2 class="section-title">‚öôÔ∏è #config - C·∫•u h√¨nh ph√≠ v√† r·ªßi ro</h2>
            <p class="config-note">ƒêi·ªÅu ch·ªânh ph√≠ n·ªÅn t·∫£ng, c·∫•u h√¨nh hoa h·ªìng/voucher v√† d·ª± ph√≤ng r·ªßi ro ho√†n h√†ng. C√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh ph·∫£n √°nh b·∫£ng ph√≠ hi·ªán t·∫°i (PiShip 1.620ƒë, ph√≠ h·∫° t·∫ßng 3.000ƒë, hoa h·ªìng li√™n k·∫øt m·∫∑c ƒë·ªãnh 0%).</p>
            <div class="config-grid">
                <div class="config-card">
                    <h3>Ph√≠ n·ªÅn t·∫£ng</h3>
                    <div id="feeConfigForm"></div>
                </div>
                <div class="config-card">
                    <h3>R·ªßi ro ho√†n h√†ng</h3>
                    <div class="config-item">
                        <label class="config-label" for="returnRate">T·ªâ l·ªá ho√†n h√†ng d·ª± ph√≤ng</label>
                        <div class="config-input">
                            <input type="number" id="returnRate" min="0" step="0.1" value="3">
                            <span class="config-unit">%</span>
                        </div>
                    </div>
                    <div class="config-item">
                        <label class="config-label" for="returnHandling">Chi ph√≠ x·ª≠ l√Ω m·ªói ƒë∆°n ho√†n</label>
                        <div class="config-input">
                            <input type="number" id="returnHandling" min="0" step="500" value="8000">
                            <span class="config-unit">VND</span>
                        </div>
                    </div>
                    <p class="config-note">D·ª± ph√≤ng r·ªßi ro ƒë∆∞·ª£c c·ªông tr·ª±c ti·∫øp v√†o chi ph√≠ ƒë·ªÉ t√≠nh h√≤a v·ªën v√† l·ª£i nhu·∫≠n.</p>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('single')">üìä Ph√¢n t√≠ch ƒë∆°n s·∫£n ph·∫©m</button>
            <button class="tab-button" onclick="switchTab('multi')">üì¶ Ph√¢n t√≠ch ƒëa s·∫£n ph·∫©m</button>
            <button class="tab-button" onclick="switchTab('profit')">üí∞ Ph√¢n t√≠ch l·ª£i nhu·∫≠n</button>
            <button class="tab-button" onclick="switchTab('analytics')">üìà Dashboard ph√¢n t√≠ch</button>
        </div>

        <!-- Single Product Analysis Tab -->
        <div id="single-tab" class="tab-content active">
            <div class="main-content">
                <div class="input-section">
                    <h2 class="section-title">üìä Th√¥ng tin ƒë·∫ßu v√†o</h2>

                    <div class="form-group">
                        <label for="costPrice">Gi√° nh·∫≠p h√†ng (VND):</label>
                        <input type="number" id="costPrice" placeholder="Nh·∫≠p gi√° nh·∫≠p h√†ng..." min="0">
                    </div>

                    <div class="form-group">
                        <label for="quantity">S·ªë l∆∞·ª£ng s·∫£n ph·∫©m:</label>
                        <input type="number" id="quantity" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng..." min="1" value="1">
                    </div>

                    <div class="form-group">
                        <label for="totalShipping">T·ªïng ph√≠ v·∫≠n chuy·ªÉn (VND):</label>
                        <input type="number" id="totalShipping" placeholder="Nh·∫≠p t·ªïng ph√≠ ship..." min="0">
                    </div>

                    <div class="form-group">
                        <label for="packagingFee">Ph√≠ ƒë√≥ng g√≥i (VND):</label>
                        <input type="number" id="packagingFee" value="1500" min="0">
                    </div>

                    <div class="form-group">
                        <label>Lo·∫°i l·ª£i nhu·∫≠n mong mu·ªën:</label>
                        <div class="profit-type">
                            <label>
                                <input type="radio" name="profitType" value="percentage" checked>
                                Ph·∫ßn trƒÉm (%)
                            </label>
                            <label>
                                <input type="radio" name="profitType" value="fixed">
                                S·ªë ti·ªÅn c·ªë ƒë·ªãnh (VND)
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="profitValue">L·ª£i nhu·∫≠n mong mu·ªën:</label>
                        <input type="number" id="profitValue" placeholder="Nh·∫≠p l·ª£i nhu·∫≠n..." min="0">
                    </div>

                    <div class="form-group">
                        <label for="pricingStrategy">Chi·∫øn l∆∞·ª£c ƒë·ªãnh gi√° th√¥ng minh:</label>
                        <select id="pricingStrategy">
                            <option value="balanced">C√¢n b·∫±ng (g·ª£i √Ω ·ªïn ƒë·ªãnh)</option>
                            <option value="growth">TƒÉng tr∆∞·ªüng (∆∞u ti√™n c·∫°nh tranh)</option>
                            <option value="premium">Premium (t·ªëi ƒëa h√≥a l·ª£i nhu·∫≠n)</option>
                        </select>
                        <small class="helper-text">C√¥ng c·ª• t·ª± tinh ch·ªânh bi√™n l·ª£i nhu·∫≠n theo chi·∫øn l∆∞·ª£c ƒë√£ ch·ªçn.</small>
                    </div>

                    <div class="cta-row">
                        <button class="cta-btn" id="calculateBtn">‚ö° T√≠nh to√°n &amp; d·ª±ng dashboard</button>
                        <div class="micro-hint">Hi·ªáu ·ª©ng ƒë·ªông v√† bi·ªÉu ƒë·ªì s·∫Ω b·∫≠t sau m·ªói l·∫ßn t√≠nh.</div>
                    </div>
                </div>

                <div class="results-section">
                    <h2 class="section-title">üìà K·∫øt qu·∫£ ph√¢n t√≠ch</h2>

                    <div class="results-grid" id="resultsGrid">
                        <div class="result-item">
                            <div class="result-label">Ph√≠ ship tr√™n ƒë∆°n v·ªã</div>
                            <div class="result-value" id="shippingPerUnit">0 VND</div>
                        </div>

                        <div class="result-item">
                            <div class="result-label">T·ªïng chi ph√≠ tr√™n ƒë∆°n v·ªã</div>
                            <div class="result-value" id="totalCostPerUnit">0 VND</div>
                        </div>

                        <div class="result-item highlight">
                            <div class="result-label">Gi√° b√°n ƒë·ªÅ xu·∫•t</div>
                            <div class="result-value" id="recommendedPrice">0 VND</div>
                        </div>

                        <div class="result-item success">
                            <div class="result-label">L·ª£i nhu·∫≠n th·ª±c t·∫ø</div>
                            <div class="result-value" id="actualProfit">0 VND (0%)</div>
                        </div>

                        <div class="result-item info">
                            <div class="result-label">L·ª£i nhu·∫≠n tr√™n chi ph√≠</div>
                            <div class="result-value" id="profitOnCost">0%</div>
                        </div>

                        <div class="result-item">
                            <div class="result-label">ƒêi·ªÉm h√≤a v·ªën</div>
                            <div class="result-value" id="breakEvenPrice">0 VND</div>
                        </div>
                    </div>

                    <div class="cost-breakdown">
                        <h3 style="margin-bottom: 15px; color: #333;">üí∞ Chi ti·∫øt chi ph√≠</h3>
                        <div id="costBreakdown"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Multi Product Analysis Tab -->
        <div id="multi-tab" class="tab-content">
            <div class="main-content single-column">
                <div class="product-list">
                    <div style="padding: 25px;">
                        <h2 class="section-title">üì¶ Danh s√°ch s·∫£n ph·∫©m</h2>

                        <!-- Mode Toggles -->
                        <div class="mode-toggles">
                            <div class="toggle-group">
                                <label>üí± Ch·∫ø ƒë·ªô ti·ªÅn t·ªá:</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="currencyMode" onchange="toggleCurrencyMode()">
                                    <span class="slider"></span>
                                </label>
                                <span id="currencyLabel">VND</span>
                            </div>
                            <div class="toggle-group">
                                <label>üöö Ph√≠ ship theo l√¥:</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="batchShippingMode" onchange="toggleBatchShipping()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Currency Conversion Settings -->
                        <div id="currencySettings" class="shipping-distribution" style="display: none;">
                            <h3 class="section-title">üí± C√†i ƒë·∫∑t chuy·ªÉn ƒë·ªïi ti·ªÅn t·ªá</h3>
                            <div class="form-group">
                                <label for="exchangeRate">T·ª∑ gi√° (VND/CNY):</label>
                                <input type="number" id="exchangeRate" value="4000" min="1" step="0.1" onchange="updateExchangeRate()">
                                <div class="currency-info">
                                    1 CNY = <span id="exchangeDisplay">4,000</span> VND
                                </div>
                            </div>
                        </div>

                        <!-- Batch Shipping Settings -->
                        <div id="batchShippingSettings" class="shipping-distribution" style="display: none;">
                            <h3 class="section-title">üöö C√†i ƒë·∫∑t ph√≠ ship theo l√¥</h3>
                            <div class="form-group">
                                <label for="totalBatchShipping">T·ªïng ph√≠ ship l√¥ h√†ng (VND):</label>
                                <input type="number" id="totalBatchShipping" placeholder="Nh·∫≠p t·ªïng ph√≠ ship..." min="0" onchange="calculateBatchShipping()">
                            </div>
                            <div class="distribution-method">
                                <label>
                                    <input type="radio" name="distributionMethod" value="equal" checked onchange="calculateBatchShipping()">
                                    <span>Chia ƒë·ªÅu</span>
                                </label>
                                <label>
                                    <input type="radio" name="distributionMethod" value="value" onchange="calculateBatchShipping()">
                                    <span>Theo gi√° tr·ªã</span>
                                </label>
                                <label>
                                    <input type="radio" name="distributionMethod" value="quantity" onchange="calculateBatchShipping()">
                                    <span>Theo s·ªë l∆∞·ª£ng</span>
                                </label>
                            </div>
                        </div>

                        <!-- Voucher Management -->
                        <div class="voucher-section">
                            <h3 class="section-title">üé´ Qu·∫£n l√Ω voucher gi·∫£m gi√°</h3>
                            <div class="voucher-form">
                                <div class="form-group">
                                    <label for="voucherType">Lo·∫°i gi·∫£m gi√°:</label>
                                    <select id="voucherType">
                                        <option value="fixed">S·ªë ti·ªÅn c·ªë ƒë·ªãnh (VND)</option>
                                        <option value="percentage">Ph·∫ßn trƒÉm (%)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="voucherValue">Gi√° tr·ªã gi·∫£m:</label>
                                    <input type="number" id="voucherValue" placeholder="Nh·∫≠p gi√° tr·ªã..." min="0">
                                </div>
                                <div class="form-group">
                                    <label for="voucherMinOrder">ƒê∆°n t·ªëi thi·ªÉu (VND):</label>
                                    <input type="number" id="voucherMinOrder" placeholder="Nh·∫≠p gi√° tr·ªã ƒë∆°n t·ªëi thi·ªÉu..." min="0">
                                </div>
                                <div class="form-group">
                                    <label for="voucherDescription">M√¥ t·∫£ voucher:</label>
                                    <input type="text" id="voucherDescription" placeholder="VD: Gi·∫£m 8,000 VND cho ƒë∆°n t·ª´ 150,000 VND">
                                </div>
                            </div>
                            <button class="excel-btn" onclick="addVoucher()">‚ûï Th√™m voucher</button>
                            <div id="voucherList"></div>
                            <div id="appliedVoucher" style="margin-top: 15px;"></div>
                        </div>

                        <!-- Excel Integration Controls -->
                        <div class="excel-controls">
                            <button class="excel-btn download" onclick="downloadTemplate()">
                                üì• T·∫£i m·∫´u Excel
                            </button>
                            <button class="excel-btn" onclick="document.getElementById('excelFileInput').click()">
                                üì§ Import t·ª´ Excel
                            </button>
                            <button class="excel-btn export" onclick="exportToExcel()">
                                üìä Export Excel
                            </button>
                        </div>

                        <input type="file" id="excelFileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFileImport(event)">

                        <!-- Import Preview Section -->
                        <div id="importPreview" class="import-preview" style="display: none;">
                            <h3>üîç Xem tr∆∞·ªõc d·ªØ li·ªáu import</h3>
                            <div id="previewContent"></div>
                            <div class="import-option">
                                <input type="radio" id="replaceData" name="importMode" value="replace" checked>
                                <label for="replaceData">Thay th·∫ø to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i</label>
                            </div>
                            <div class="import-option">
                                <input type="radio" id="mergeData" name="importMode" value="merge">
                                <label for="mergeData">Th√™m v√†o d·ªØ li·ªáu hi·ªán t·∫°i</label>
                            </div>
                            <div class="import-actions">
                                <button class="excel-btn" onclick="confirmImport()">‚úÖ X√°c nh·∫≠n Import</button>
                                <button class="excel-btn" onclick="cancelImport()" style="background: #6c757d;">‚ùå H·ªßy b·ªè</button>
                            </div>
                        </div>

                        <div id="importMessages"></div>

                        <button class="add-product-btn" onclick="addProduct()">‚ûï Th√™m s·∫£n ph·∫©m m·ªõi</button>
                        <div id="productList"></div>
                    </div>
                </div>

                <div class="results-section">
                    <h2 class="section-title">üìä T·ªïng k·∫øt ƒëa s·∫£n ph·∫©m</h2>
                    <div class="analytics-grid" id="multiProductResults">
                        <div class="analytics-card">
                            <div class="analytics-value" id="totalOrderValue">0 VND</div>
                            <div class="analytics-label">T·ªïng gi√° tr·ªã ƒë∆°n h√†ng</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-value" id="totalProfit">0 VND</div>
                            <div class="analytics-label">T·ªïng l·ª£i nhu·∫≠n</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-value" id="totalCost">0 VND</div>
                            <div class="analytics-label">T·ªïng chi ph√≠</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-value" id="avgProfitMargin">0%</div>
                            <div class="analytics-label">T·ª∑ su·∫•t l·ª£i nhu·∫≠n TB</div>
                        </div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header" onclick="toggleSection('productBreakdown', event)">
                            <span>üìã Chi ti·∫øt t·ª´ng s·∫£n ph·∫©m</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="expandable-content" id="productBreakdown">
                            <table class="comparison-table" id="productComparisonTable">
                                <thead>
                                    <tr>
                                        <th>S·∫£n ph·∫©m</th>
                                        <th>Chi ph√≠</th>
                                        <th>Gi√° b√°n</th>
                                        <th>L·ª£i nhu·∫≠n</th>
                                        <th>T·ª∑ su·∫•t (%)</th>
                                        <th>S·ªë l∆∞·ª£ng</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profit Analysis Tab -->
        <div id="profit-tab" class="tab-content">
            <div class="main-content">
                <div class="profit-analysis-section">
                    <h2 class="section-title">üí∞ Ph√¢n t√≠ch l·ª£i nhu·∫≠n th·ª±c t·∫ø</h2>

                    <div class="form-group">
                        <label for="actualSellingPrice">Gi√° b√°n th·ª±c t·∫ø (VND):</label>
                        <input type="number" id="actualSellingPrice" placeholder="Nh·∫≠p gi√° b√°n th·ª±c t·∫ø..." min="0">
                    </div>

                    <div class="form-group">
                        <label for="actualCostPrice">Gi√° nh·∫≠p th·ª±c t·∫ø (VND):</label>
                        <input type="number" id="actualCostPrice" placeholder="Nh·∫≠p gi√° nh·∫≠p th·ª±c t·∫ø..." min="0">
                    </div>

                    <div class="form-group">
                        <label for="actualQuantity">S·ªë l∆∞·ª£ng b√°n (ƒë∆°n v·ªã):</label>
                        <input type="number" id="actualQuantity" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng..." min="1" value="1">
                    </div>

                    <div class="form-group">
                        <label for="actualShipping">Ph√≠ v·∫≠n chuy·ªÉn th·ª±c t·∫ø (VND):</label>
                        <input type="number" id="actualShipping" placeholder="Nh·∫≠p ph√≠ ship..." min="0">
                    </div>
                </div>

                <div class="results-section">
                    <h2 class="section-title">üìà K·∫øt qu·∫£ ph√¢n t√≠ch l·ª£i nhu·∫≠n</h2>

                    <div class="results-grid" id="profitAnalysisResults">
                        <div class="result-item success">
                            <div class="result-label">L·ª£i nhu·∫≠n tr√™n doanh thu</div>
                            <div class="result-value" id="profitOnRevenue">0% (0 VND)</div>
                        </div>

                        <div class="result-item info">
                            <div class="result-label">L·ª£i nhu·∫≠n tr√™n chi ph√≠</div>
                            <div class="result-value" id="profitOnCostActual">0% (0 VND)</div>
                        </div>

                        <div class="result-item highlight">
                            <div class="result-label">ROI (L·ª£i t·ª©c ƒë·∫ßu t∆∞)</div>
                            <div class="result-value" id="roi">0%</div>
                        </div>

                        <div class="result-item">
                            <div class="result-label">L·ª£i nhu·∫≠n/ƒë∆°n v·ªã</div>
                            <div class="result-value" id="profitPerUnit">0 VND</div>
                        </div>

                        <div class="result-item">
                            <div class="result-label">L·ª£i nhu·∫≠n/l√¥ h√†ng</div>
                            <div class="result-value" id="profitPerBatch">0 VND</div>
                        </div>

                        <div class="result-item warning">
                            <div class="result-label">T·ªïng doanh thu</div>
                            <div class="result-value" id="totalRevenue">0 VND</div>
                        </div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header" onclick="toggleSection('profitComparison', event)">
                            <span>üîç So s√°nh d·ª± ki·∫øn vs th·ª±c t·∫ø</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="expandable-content" id="profitComparison">
                            <div id="comparisonMetrics"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Dashboard Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="main-content single-column">
                <div class="chart-container">
                    <h2 class="section-title">üìä Dashboard ph√¢n t√≠ch t·ªïng quan</h2>

                    <div class="analytics-grid">
                        <div class="analytics-card success">
                            <div class="analytics-value" id="dashTotalRevenue">0 VND</div>
                            <div class="analytics-label">T·ªïng doanh thu</div>
                        </div>
                        <div class="analytics-card info">
                            <div class="analytics-value" id="dashTotalCost">0 VND</div>
                            <div class="analytics-label">T·ªïng chi ph√≠</div>
                        </div>
                        <div class="analytics-card highlight">
                            <div class="analytics-value" id="dashTotalProfit">0 VND</div>
                            <div class="analytics-label">T·ªïng l·ª£i nhu·∫≠n</div>
                        </div>
                        <div class="analytics-card warning">
                            <div class="analytics-value" id="dashAvgMargin">0%</div>
                            <div class="analytics-label">T·ª∑ su·∫•t LN trung b√¨nh</div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <div>
                                    <p class="chart-kicker">Radar chi ph√≠</p>
                                    <h3>üß≠ C∆° c·∫•u chi ph√≠</h3>
                                </div>
                                <span class="pill">Live</span>
                            </div>
                            <canvas id="costDonutChart" height="200"></canvas>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <div>
                                    <p class="chart-kicker">Xu h∆∞·ªõng l·ª£i nhu·∫≠n</p>
                                    <h3>üöÄ Revenue &amp; Profit</h3>
                                </div>
                                <span class="pill accent">Realtime</span>
                            </div>
                            <canvas id="profitSparkChart" height="200"></canvas>
                        </div>
                        <div class="chart-card wide">
                            <div class="chart-header">
                                <div>
                                    <p class="chart-kicker">Bi√™n l·ª£i nhu·∫≠n</p>
                                    <h3>üìà Margin Benchmark</h3>
                                </div>
                                <span class="pill muted">Pro insight</span>
                            </div>
                            <canvas id="marginBarChart" height="120"></canvas>
                            <div class="chart-footnote">So s√°nh bi√™n l·ª£i nhu·∫≠n th·ª±c t·∫ø v·ªõi m·ª•c ti√™u 25% v√† m·ª©c c√¢n b·∫±ng.</div>
                        </div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header" onclick="toggleSection('costStructure', event)">
                            <span>üèóÔ∏è C·∫•u tr√∫c chi ph√≠</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="expandable-content" id="costStructure">
                            <div id="costStructureAnalysis"></div>
                        </div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header" onclick="toggleSection('profitDistribution', event)">
                            <span>üìà Ph√¢n b·ªë l·ª£i nhu·∫≠n</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="expandable-content" id="profitDistribution">
                            <div id="profitDistributionAnalysis"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>ƒê∆∞·ª£c ph√°t tri·ªÉn b·ªüi <strong>DKhanhzev</strong> | ¬© 2024</p>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">ƒêang x·ª≠ l√Ω...</p>
        </div>
    </div>

        <script src="app.js"></script>
</body>
</html>
